<div class="container-fluid">

    <div class="container-fluid px-5 d-flex flex-wrap jusify-content-start align-items-top">
        <button mat-button color='primary' (click)="goToList()"><mat-icon>keyboard_backspace</mat-icon></button>
    </div>

    <form [formGroup]="_com.hotelSearch" (ngSubmit)="cotizar()">
        <div class="container-fluid px-5 d-flex flex-wrap jusify-content-start align-items-top">
            
            <!-- FECHA -->
            <mat-form-field class="mx-1 mb-2 text-mat-primary" appearance="outline" [style.width.px]="235" >
                <mat-label>Fecha</mat-label>
                <mat-date-range-input [rangePicker]="picker">
                    <input matStartDate readonly autocomplete="off" [min]="minDate" [max]="maxDate" formControlName="inicio" placeholder="Inicio">
                    <input matEndDate   readonly autocomplete="off" [max]="maxDate" formControlName="fin" placeholder="Fin">
                </mat-date-range-input>
                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-date-range-picker #picker></mat-date-range-picker>
                <mat-error *ngIf="_com.hotelSearch.controls['inicio'].invalid">{{ getErrorMessage('inicio') }}</mat-error>
                <mat-error *ngIf="_com.hotelSearch.controls['fin'].invalid">{{ getErrorMessage('fin') }}</mat-error>
            </mat-form-field>

            <section class="d-flex flex-wrap justify-content-start mt-1" style="max-width: 500px; font-size: x-small; align-content: flex-start; text-transform: uppercase;">
                <mat-checkbox class="me-1 text-truncate" style="height: 25px; width: 120px" *ngFor="let h of collections['sf_hoteles']"><span class='text-truncate'>{{ h['label'] }}</span></mat-checkbox>
            </section>

            <div class='ms-auto mt-2'>
                <button mat-stroked-button color="primary" style="text-transform: uppercase;" [disabled]="_com.hotelSearch.invalid || loading['cotizar']">buscar disponibilidad</button>
            </div>
    
        </div>
        
        <div class="container-fluid px-5 d-flex flex-wrap jusify-content-start align-items-top">

            <mat-radio-group class='upper' aria-label="Tipo de Cotizacion" formControlName="isQuote">
                <mat-radio-button class="me-4" [value]="false">Cotización Detallada</mat-radio-button>
                <mat-radio-button class="me-2" [value]="true">Cotización Básica</mat-radio-button>
            </mat-radio-group>

            <mat-radio-group class='ms-auto upper' aria-label="Tipo de Cotizacion" formControlName="isUSD">
                <mat-radio-button class="me-2" [value]="false">MXN</mat-radio-button>
                <mat-radio-button class="me-2" [value]="true">USD</mat-radio-button>
            </mat-radio-group>

        </div>
    
    </form>

    <!-- RESULTADOS -->
    <mat-card class="mt-3 px-0" *ngIf="!loading['cotizar'] && cotizacion.length > 0">

        <!-- OPCIONES PARA COMERCIAL -->
        <display-options [cotizacion]="cotizacion" [oportunidad]="opp.opportunityForm" *ngIf="isComercial"></display-options>

    </mat-card>
    
    <mat-card>
        <mat-card-header class="text-end">
            <mat-card-title>Cotizador {{ _com.cotizadorType }}</mat-card-title>
        </mat-card-header>
        
        <mat-card-content>

            <oportunidades-search (dateChange)="changeSearchDate($event)" (opReady)="comercialSetFilters( $event )" [visible]="isComercial"></oportunidades-search>

            <ng-container *ngIf="filtersReady">
                
                    <div class="container-fluid d-flex justify-content-center flex-wrap align-items-center">

                        <!-- HABITACIONES -->
                        <mat-form-field class="mx-1 mb-2" appearance="outline" [style.width.px]="100"  *ngIf="!isComercial">
                            <mat-label>Habitaciones</mat-label>
                            <input matInput class="text-center" type="number" formControlName="habs" min=1 max=10 autocomplete="off">
                            <mat-error *ngIf="_com.hotelSearch.controls['habs'].invalid">{{ getErrorMessage('habs') }}</mat-error>
                        </mat-form-field>
                        
                        
        
                        <!-- GRUPO -->
                        <mat-form-field class="mx-1 mb-2" appearance="outline" [style.width.px]="170"  *ngIf="!isComercial">
                            <mat-label>Grupo</mat-label>
                            <mat-select formControlName="grupo" fname="grupo">
                                <mat-option>Selecciona</mat-option>
                                <ng-container *ngFor="let g of grupos">
                                    <mat-option [value]="g" *ngIf="g['mainCampaign'] == '1'">
                                        {{ g['grupo'] }}
                                    </mat-option>
                                </ng-container>
                            </mat-select>
                            <!-- <mat-hint>Selecciona un tipo de servicio</mat-hint> -->
                            <mat-error *ngIf="_com.hotelSearch.controls['grupo'].invalid">{{ getErrorMessage('grupo') }}</mat-error>
                        </mat-form-field>
        
        
                        <!-- Switches -->
                        <div class="ms-auto d-flex flex-wrap justify-content-end">
                            <mat-slide-toggle class="mx-1 mb-2" formControlName="isQuote" *ngIf="isComercial">{{ _com.hotelSearch.get('isQuote').value ? 'Cotizacion' : 'Desgloce' }}</mat-slide-toggle>
                            <mat-slide-toggle class="mx-1 mb-2" formControlName="isUSD">USD</mat-slide-toggle>
                            <button mat-raised-button class="ms-3" color="primary" (click)="cotizar()" [disabled]="_com.hotelSearch.invalid || loading['cotizar']">Cotizar</button>
                        </div>
        
                        
        
                    </div>  
                    <mat-accordion  *ngIf="!isComercial">
                        <mat-expansion-panel [expanded]="filterExpanded">
                            <mat-expansion-panel-header>
                                <mat-panel-title>
                                    Pax por habitación
                                </mat-panel-title>
                            </mat-expansion-panel-header>
                            <!-- <mat-panel-description> -->
                                <div class="container" formGroupName="habitaciones">
                    
                                    <!-- PAX -->
                                    <div class="pt-3  mx-3 d-flex justify-content-start flex-wrap align-items-center" [formGroupName]="'hab' + (i+1)" *ngFor="let h of _com.hotelSearch.controls.habitaciones.value | keys, index as i">
                                        <h3>Hab. {{ i + 1 }}</h3>
                                        <mat-form-field class="ms-3 me-1 mb-2" appearance="outline" [style.width.px]="100">
                                            <mat-label>Adultos</mat-label>
                                            <input matInput class="text-center" type="number" formControlName="adultos" min=1 max=4 autocomplete="off">
                                            <mat-hint>> de 12 años</mat-hint>
                                            <mat-error *ngIf="_com.hotelSearch.get('habitaciones.hab'+(i+1)+'.adultos').invalid">{{ getErrorMessage('habitaciones.hab'+(i+1)+'.adultos') }}</mat-error>
                                        </mat-form-field>
                                        <mat-form-field class="mx-1 mb-2" appearance="outline" [style.width.px]="100">
                                            <mat-label>Menores</mat-label>
                                            <input matInput class="text-center" type="number" formControlName="menores" min=0 max=3 autocomplete="off">
                                            <mat-hint>0 a 12 años</mat-hint>
                                            <mat-error *ngIf="_com.hotelSearch.get('habitaciones.hab'+(i+1)+'.menores').invalid">{{ getErrorMessage('habitaciones.hab'+(i+1)+'.menores') }}</mat-error>
                                        </mat-form-field>
                                        <ng-container formGroupName="edades">
                                            <mat-form-field class="mx-1 mb-2" appearance="outline" [style.width.px]="100" *ngIf="_com.hotelSearch.get('habitaciones.hab'+(i+1)+'.menores').value >= 1">
                                                <mat-label>Edad 1</mat-label>
                                                <input matInput class="text-center" type="number" formControlName="menor_1" min=0 max=12 autocomplete="off">
                                                <mat-hint>0 a 12 años</mat-hint>
                                                <mat-error *ngIf="_com.hotelSearch.get('habitaciones.hab'+(i+1)+'.edades.menor_1').invalid">{{ getErrorMessage('habitaciones.hab'+(i+1)+'.edades.menor_1') }}</mat-error>
                                            </mat-form-field>
                                            <mat-form-field class="mx-1 mb-2" appearance="outline" [style.width.px]="100" *ngIf="_com.hotelSearch.get('habitaciones.hab'+(i+1)+'.menores').value >= 2">
                                                <mat-label>Edad 2</mat-label>
                                                <input matInput class="text-center" type="number" formControlName="menor_2" min=0 max=12 autocomplete="off">
                                                <mat-hint>0 a 12 años</mat-hint>
                                                <mat-error *ngIf="_com.hotelSearch.get('habitaciones.hab'+(i+1)+'.edades.menor_2').invalid">{{ getErrorMessage('habitaciones.hab'+(i+1)+'.edades.menor_2') }}</mat-error>
                                            </mat-form-field>
                                            <mat-form-field class="mx-1 mb-2" appearance="outline" [style.width.px]="100" *ngIf="_com.hotelSearch.get('habitaciones.hab'+(i+1)+'.menores').value >= 3">
                                                <mat-label>Edad 3</mat-label>
                                                <input matInput class="text-center" type="number" formControlName="menor_3" min=0 max=12 autocomplete="off">
                                                <mat-hint>0 a 12 años</mat-hint>
                                                <mat-error *ngIf="_com.hotelSearch.get('habitaciones.hab'+(i+1)+'.edades.menor_3').invalid">{{ getErrorMessage('habitaciones.hab'+(i+1)+'.edades.menor_1') }}</mat-error>
                                            </mat-form-field>
                                        </ng-container>
                                        <!-- <mat-form-field class="mx-1 mb-2" appearance="outline" [style.width.px]="70">
                                            <mat-label>Adultos</mat-label>
                                            <input matInput class="text-center" type="number" formControlName="adultos" min=0 autocomplete="off">
                                            <mat-hint>> 12 años</mat-hint>
                                            <mat-error *ngIf="xferSearch.controls['adultos'].invalid">{{ getErrorMessage('adultos') }}</mat-error>
                                        </mat-form-field>
                                        <mat-form-field class="mx-1 mb-2" appearance="outline" [style.width.px]="70">
                                            <mat-label>Niños</mat-label>
                                            <input matInput class="text-center" type="number" formControlName="children" min=0 autocomplete="off">
                                            <mat-hint>1 a 12 años</mat-hint>
                                            <mat-error *ngIf="xferSearch.controls['children'].invalid">{{ getErrorMesssage('children') }}</mat-error>
                                        </mat-form-field>
                                        <mat-form-field class="mx-1 mb-2" appearance="outline" [style.width.px]="70">
                                            <mat-label>Bebés</mat-label>
                                            <input matInput class="text-center" type="number" formControlName="babies" min=0 autocomplete="off">
                                            <mat-hint>hasta 11 meses</mat-hint>
                                            <mat-error *ngIf="xferSearch.controls['babies'].invalid">{{ getErrorMessage('babies') }}</mat-error>
                                        </mat-form-field> -->
                                    </div>
                    
                                </div>
                            <!-- </mat-panel-description> -->
                        </mat-expansion-panel>
                    </mat-accordion>
        

            </ng-container>
        </mat-card-content>

        <mat-card-actions>
            <div class="container-fluid d-flex justify-content-end mt-0 pt-0 flex-wrap">
                <div>
                    <!-- <button mat-raised-button class="me-2" color="warn" (click)="resetValues()">Reset</button> -->
                </div>
                <div>
                    <!-- <button mat-raised-button color="primary" (click)="cotizar()" [disabled]="noDispo || noTours || tourSearch.invalid">Cotizar</button> -->
                </div>
            </div>
        </mat-card-actions>
            
            
        
        <mat-card-footer>
                <mat-progress-bar mode="indeterminate" *ngIf="(_api.isLoading | async) || loading['cotizar'] || loading['searchop']"></mat-progress-bar>
        </mat-card-footer>
    </mat-card>

    

    <div style="position: fixed; bottom: 40px; right: 40px;">
        <button mat-fab color="primary" [matBadge]="_com.cart.length" [matBadgeHidden]="_com.cart.length == 0" matBadgeColor="accent" (click)="dsp.checkOutDialog(_com.cart)">
          <mat-icon>shopping_cart</mat-icon>
        </button>
    </div>

</div>




